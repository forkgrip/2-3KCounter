<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width" content="initial-scale=1.0">
    <title>2-3点数カウンター(記録のみ)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
        }

        .container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            width: 90%;
            max-width: 500px;
            margin: 0 auto;
        }

        button, input[type="text"], .box {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 1.2em;
        }

        button {
            background-color: #4CAF50; /* デフォルトのボタン色 */
            color: white;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .full-width {
            grid-column: span 4;
            text-align: center;
            font-weight: bold;
        }

        .counter-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .score {
            margin-top: 10px;
            font-weight: bold;
        }

        /* 押された難易度ボタンのスタイル */
        .selected {
            background-color: #4CAF50 !important; /* 緑色 */
        }

        /* 初期状態の難易度ボタンのスタイル */
        .difficulty-button {
            background-color: #FF6347; /* トマト色 */
        }

        /* スマホ向けのスタイル */
        @media (max-width: 600px) {
            .container {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            button, input[type="text"], .box {
                padding: 10px;
                font-size: 1em;
            }

            .counter-controls {
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="score full-width" id="scoreDisplay">
            難易度を選択して，スタートを押すと，タイマー開始
        </div>
        <div class="score full-width" id="scoreDisplay">
            終了ボタンで，点数に得点が表示されます
        </div>
        <button id="startButton">スタート</button>
        <button id="stopButton">終了</button>
        <button id="easyButton" class="difficulty-button">カンタン</button>
        <button id="hardButton" class="difficulty-button">ムズイ</button>

        <div class="box full-width" id="timerDisplay">経過時間: 0m 0s</div>
        <div class="box full-width" id="countdownDisplay">残り時間: 0m 0s</div>

        <div class="box">落とした回数</div>
        <div class="box" id="countDisplay">0</div>

        <div class="counter-controls full-width">
            <button id="decreaseButton">-</button>
            <button id="increaseButton">+</button>
        </div>

        <div class="box full-width">
            <label for="nickname">ニックネーム</label>
            <input type="text" id="nickname" placeholder="名前を入力">
        </div>

        <button class="full-width" id="resetButton">リセット</button>

        <div class="score full-width" id="scoreDisplay">
            点数 = 100 - (回数 × 2) - (経過秒数 - 基準秒) ... 基準秒: 簡単=180秒，ムズイ=240秒
        </div>
        <div class="score full-width" id="scoreDisplay">
            時間切れの場合は，どちらの難易度でも，30点に固定されます
        </div>


    </div>

    <script>
        let timer; // タイマー制御用の変数
        let countdown; // カウントダウン用の変数
        let elapsedSeconds = 0; // 経過時間（秒）
        let count = 0; // 落とした回数
        let baseTime = null; // カンタン/ムズイで変わる基準秒
        let countdownTime = 0; // カウントダウンの時間
        let selectedDifficulty = null; // 現在選択されている難易度

        // タイマー表示の更新関数
        function updateTimerDisplay() {
            const minutes = Math.floor(countdownTime / 60);
            const seconds = countdownTime % 60;
            document.getElementById('countdownDisplay').textContent = `カウントダウン: ${minutes}m ${seconds}s`;
        }

        // 経過時間の表示を更新する関数
        function updateElapsedDisplay() {
            const elapsedMinutes = Math.floor(elapsedSeconds / 60);
            const elapsedSecondsDisplay = elapsedSeconds % 60;
            document.getElementById('timerDisplay').textContent = `経過時間: ${elapsedMinutes}m ${elapsedSecondsDisplay}s`;
        }

        // 点数の更新関数 (終了時のみ呼ばれる)
        function updateScore() {
            let score;
            // 経過時間が基準秒を超えた場合、点数を30にする
            if (elapsedSeconds > baseTime) {
                score = 30;
            } else {
                score = 100 - (count * 2) - (elapsedSeconds - baseTime);
            }
            document.getElementById('scoreDisplay').textContent = `点数 = ${score}`;
        }

        // タイマーのスタート処理
        document.getElementById('startButton').addEventListener('click', () => {
            if (baseTime === null) {
                alert('「カンタン」か「ムズイ」を選択してください。');
                return; // タイマーをスタートしない
            }
            clearInterval(timer); // 二重実行を防ぐため停止
            clearInterval(countdown); // カウントダウンを停止

            // カウントダウンの時間を設定
            countdownTime = selectedDifficulty === 'easyButton' ? 180 : 240; // カンタン=3分, ムズイ=4分
            updateTimerDisplay(); // カウントダウン表示の初期化

            countdown = setInterval(() => {
                if (countdownTime > 0) {
                    countdownTime--;
                    updateTimerDisplay();
                } else {
                    clearInterval(countdown);
                    // 終了時の処理を呼び出す
                    updateScore(); // 点数を更新
                    alert('時間切れ！');
                }
            }, 1000);

            // タイマーの経過時間を更新する
            timer = setInterval(() => {
                elapsedSeconds++;
                updateElapsedDisplay(); // 経過時間表示を更新
            }, 1000);
        });

        // タイマーの終了処理（点数を計算・表示）
        document.getElementById('stopButton').addEventListener('click', () => {
            clearInterval(timer);
            clearInterval(countdown); // カウントダウンを停止
            updateScore(); // 点数を更新
        });

        // カウントの増加
        document.getElementById('increaseButton').addEventListener('click', () => {
            count++;
            document.getElementById('countDisplay').textContent = count;
        });

        // カウントの減少
        document.getElementById('decreaseButton').addEventListener('click', () => {
            if (count > 0) {
                count--;
                document.getElementById('countDisplay').textContent = count;
            }
        });

        // 難易度ボタンが押されたときに色を変更する
        function selectDifficulty(buttonId, time) {
            baseTime = time;
            selectedDifficulty = buttonId; // 現在の難易度を保持

            // 全ての難易度ボタンの選択状態を解除する
            document.getElementById('easyButton').classList.remove('selected');
            document.getElementById('hardButton').classList.remove('selected');
            
            // 押されたボタンに選択状態を付与する
            document.getElementById(buttonId).classList.add('selected');
        }

        // 「カンタン」ボタンが押されたとき
        document.getElementById('easyButton').addEventListener('click', () => {
            selectDifficulty('easyButton', 180); // カンタンの基準秒
        });

        // 「ムズイ」ボタンが押されたとき
        document.getElementById('hardButton').addEventListener('click', () => {
            selectDifficulty('hardButton', 240); // ムズイの基準秒
        });

        // リセットボタンの処理
        document.getElementById('resetButton').addEventListener('click', () => {
            // タイマーのリセット
            clearInterval(timer);
            clearInterval(countdown);
            elapsedSeconds = 0;
            countdownTime = 0; // カウントダウンもリセット
            updateElapsedDisplay(); // 経過時間の表示をリセット
            updateTimerDisplay(); // カウントダウンの表示をリセット

            // カウントのリセット
            count = 0;
            document.getElementById('countDisplay').textContent = count;

            // ニックネームのリセット
            document.getElementById('nickname').value = '';

            // 点数のリセット
            document.getElementById('scoreDisplay').textContent = '点数 = 100 - (回数 × 2) - (経過秒数 - 基準秒)';

            // 基準秒のリセット
            baseTime = null;

            // 難易度ボタンの選択状態はリセットされない
        });
    </script>
</body>
</html>
